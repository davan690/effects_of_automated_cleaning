---
title: "Automated filtering of species occurrence data can identify problems, but needs to be customized"
author: 
- Alexander Zizka^1,2^,
- Alice Calvente^3^,
- Fernanda Antunes Carvalho^4,5^,
- Ana Paula Alves da Silva,
- Andressa Cabral,
- Arthur de Souza Soares,
- Eduardo Calisto Tomaz,
- Fernanda Gondim Lambert Moreira,
- Filipe Serrano,
- Jéssica Fernanda Ramos Coelho,
- Mabel Rocio Baez-Lizarazo,
- Mariana Ramos Fantinati,
- Matheus Colli-Silva,
- Moabe Ferreira Fernandes,
- Nathália Michelly da Cunha Santos,
- Paolla G. C. Souza,
- Renata Clícia Santos da Costa,
- Thais Ferreira Pinto de Araújo,
- Tiago Andrade Borges Santos,
- Tiago Luiz Vieira,
- Valéria Fonseca Vale,
- Alexandre Antonelli^6^
#bibliography: course_natal.bib
csl: jbi-3.csl
output:
  word_document:
  #bookdown::pdf_document2:
    toc: false
    toc_depth: 1
    fig_caption: true
   # number_sections: false
   # keep_tex: yes
header-includes: |
    \usepackage{caption}
    \usepackage{fancyhdr}
    \usepackage{booktabs}
    \pagestyle{fancy}
    \fancyhead[L]{Automated filter effect}
    \fancyhead[LE,RO]{\thepage}
    \fancyfoot{}
    \usepackage{float}
    \floatplacement{figure}{H}
    \usepackage{lineno}
    \linenumbers
linestretch: 1.3
fontsize: 12pt
always_allow_html: yes
---


1. sDiv,German Center for Integrative Biodiversity Research (iDiv), Leipzig, Germany
2. Naturalis Biodiversity Center, Leiden, The Netherlands
3. Laboratório de Botânica Sistemática, Departamento de Botânica e Zoologia, Centro de Biociências, Universidade Federal do Rio Grande do Norte.
4. Departamento de Genética, Ecologia e Evolução, Instituto de Ciências Biológicas, Universidade Federal de Minas Gerais, Av. Antônio Carlos 6627 - Pampulha, 31270-901 - Belo Horizonte - MG - Brasil

\newpage{}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
library(knitr)
library(kableExtra)
library(readxl)
library(dplyr)
library(readr)
library(tidyr)

knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})
```


```{r}
# load and prepare data
dat <- read_csv("output/all_records.csv") %>% 
  filter(!is.na(decimalLongitude)) %>% 
  filter(!is.na(decimalLatitude))

dat_cl <-  dat %>% 
  filter(summary)
```

# Abstract
Automatic flagging and subsequent filtering are a scalable and reproducible means to identify potentially problematic records in 'big data' datasets of species geographic occurrences from public databases (e.g., www.gbif.org). However, it is unclear how big the data loss by filtering is, if similar test should be applied across taxonomic groups, and what the effect of filtering is for downstream analyses. Here, we obtained occurrence records for 16 taxa including plants and animals as well as terrestrial and marine groups from www.gbif.org and documented the effect of 13 recently proposed filters in each group. We evaluated the effect of filtering on the inference of species richness patterns and the accuracy of automated conservation assessments as examples for downstream analyses. We found 29-67% of the records potentially problematic across taxonomic groups. The tests for duplicated information, collection year, basis of record as well as urban areas and political centroids were most important. While many of the flagged records might not be erroneous per se, they might be overly imprecise, increase uncertainty of downstream analyses and generate unnecessary computational burden. Overall, our results stress the importance of (meta-)data exploration for biogeographic research and suggest that automated flagging can help to identify problematic records, but also highlight the necessity to customize tests and thresholds to the taxonomic group and geographic area of interest.

# Keywords
Automated cleaning, automated conservation assessment, data quality, GBIF, Neotropics

\newpage{}

# Introduction
Publicly available species distribution data have become a crucial resource in biogeographic research. In particular, the availability of digitized collections from museums and herbaria, and citizen science observations has increased in the last years. As of today, the largest public aggregator for geo-referenced species occurrences data, the Global Biodiversity Information Facility (www.gbif.org), provides access to more than 1.3 billion geo-referenced occurrence records for species from across the globe and the tree of life. 

A central challenge to the use of these publicly available species occurrence data in research are erroneous geographic coordinates [@Anderson2016]. Errors mostly arise, because public databases integrate records collected with different methodology in different places at different times, often with little centralized curation and meta-data. For instance, erroneous coordinates caused by data-entry errors or automated geo-referencing from vague locality descriptions are common [@Maldonado2015; @Yesson2007] and cause recurrent problems such as records of terrestrial species in the sea, records with coordinates assigned to the centroids of political entities, or records from species in captivity [@Zizka2019].

Manual data cleaning based on expert knowledge can detect these issues, but is only feasible on small taxonomic or geographic scales and is difficult to reproduce. Automated flagging methods to identify potentially problematic records have been proposed as a scalable alternative for datasets with millions of records from many different taxa. Those methods are usually based on geographic gazetteers [e.g., @Chamberlain2016; @Zizka2019; @Jin2020] or on additional data, such as environmental variables [@Robertson2016]. Additionally, filtering procedures based on record meta-data, for instance collection year, record type, and coordinate precisions have been proposed to improve the quality of publicly available occurrence records for biogeographic research [@Zizka2019]. While these methods can identify common errors, it is unclear if errors are equally common across taxonomic groups, and which errors are most severe for downstream analyses.

Erroneous records are especially problematic in conservation, where stakes are high. Recently, automated conservation assessment methods have been developed to use publicly available occurrence records for conservation, in particular to support the assessment procedures for the global Red List of the International Union for the Conservation of Nature (IUCN) [@Dauby2017; @Bachman2011; @Pelletier2018]. These methods approximate species' range size, namely the Extent of Occurrence (EOO, which is the area of a convex hull polygon comprising all records of a species), the Area of Occupancy (AOO, which is the sum of the area actually occupied by a species, calculated based on a small-scale regular grid), and the number of locations for a preliminary conservation assessment following IUCN Criterion B. Automated assessments using these methods have been used to speed up global [@Stevart2019; @Zizka2019a] and regional [@Schmidt2017; @Cosiaux2018] Red List assessments. Since especially EOO is sensitive to individual records with erroneous coordinates automated conservation assessments might be prone to bias by erroneous records, especially, if the number of records is low, as is the case for many species from the tropical regions of Earth.

Here, we test the effect of automated filtering of species geographic occurrence records on the number of records available in different plant and animal groups. Furthermore, we test the impact of automated filtering procedures on the accuracy of automated conservation assessments compared to full IUCN assessments. Specifically, we test a pipeline of 13 tests to automatically flag possibly erroneous records 1) using record meta-data and 2) using geographic gazetteers. We address thee questions:

1. Which is the most relevant filter, i.e. which type of error is most common?
2. Does the importance of individual filters differ among taxonomic groups?
3. Does automated filtering improve the accuracy of automated conservation assessment compared to the global IUCN Red List?

# Material and Methods
We did all analysis in the R computing environment [@rcoreteam2019], using standard libraries for data handling and visualization [@Wickham2018; @Garnier2018; @Ooms2014; @Ooms2019; @Hijmans2019]. All analysis scripts are available from https://github.com/idiv-biodiversity/effects_of_automated_cleaning.

## Choice of study taxa
This study is the outcome of a workshop at the Federal University of Rio Grande do Norte in Natal, Brazil in October 2018 gathering taxonomists and biogeographers working with different taxonomic groups of plants and animals across the Neotropics. Each participant analysed geographic occurrence data from their taxonomic group of interest and provided an assessment of the results for this group. Hence, we chose the study groups based on the expertise of the participants which enabled us to compare the results across the tree of life (at the coast of an arbitrary choice of taxa and taxonomic ranks). We obtained public occurrence records for 16 taxa, including one plant family, eight plant genera, one genus of fungi, two families and one genus of terrestrial arthropods, one family of snakes, one family of skates and one genus of fish (Table 1).
 
## Species occurrence data
We downloaded occurrence information for all study groups from www.gbif.org using the `rgbif` v1.4.0 package [@Chamberlain2017] in R [@GBIForg2019; @GBIForg2019a; @GBIForg2019b; @GBIForg2019c; @GBIForg2019d; @GBIForg2019e; @GBIForg2019f; @GBIForg2019g; @GBIForg2019h; @GBIForg2019i; @GBIForg2019j; @GBIForg2019k; @GBIForg2019l; @GBIForg2019m; @GBIForg2019n; @GBIForg2019o]. We chose www.gbif.org for this study, since it is the largest and most widely used provider of species occurrence data and covers the entire tree of life. We downloaded only records with geographic coordinates, and limited the study area to latitudes smaller than 33$^\circ$ N and longitudes smaller than 35$^\circ$ W and larger than 120$^\circ$ W reflecting our area of expertise [the Neotropics, @Morrone2014].
 
##  Automated cleaning
We followed the cleaning pipeline outlined by @Zizka2019 and first filtered the raw data downloaded from GBIF ("raw", hereafter) using meta-data for those records for which it was available, removing: 1) records with a coordinate precision below 100 km (as this represent the grain size of many macro-ecological analyses); 2) fossil records and records of unknown source; 3) records collected before 1945 (before the end of the Second World War, since coordinates of old records are often imprecise and often reflect different land-use types); and 4) records with less than 1 and more than 99 individual records. Furthermore, we rounded the geographic coordinates to four decimal precision and retained only one record per species per location. In a second step, we used the `clean_coordinates` function of the `CoordinateCleaner v2.0-11` package [@Zizka2019] with default options to flag errors that are common to biological collections, including: sea coordinates, zero coordinates, coordinates assigned to country and province centroids, coordinates within urban areas, and coordinates assigned to biodiversity institutions ("filtered", hereafter). See Table 2 for a summary of all flagging tests we used.

## Downstream analyses
We first generated species richness maps using 100x100 km grid cells for the raw and filtered dataset respectively, using the `speciesgeocodeR v2.0-10` package [@Topel2016] and then performed a preliminary conservation assessment for all study groups based on both datasets using the `ConR v1.2.4` package [@Dauby2017]. `ConR` estimates the EOO, AOO, and the number of locations, and then suggests a preliminary conservation status based on Criterion B of the global IUCN Red List. While these assessments are preliminary [see @IUCN2017], they can be a proxy for full assessments and are used by the IUCN to speed up full assessments. We then benchmarked the preliminary conservation assessments with the global IUCN Red List assessments, which we obtained from www.iucn.org via the `rredlist v.0.5.0` package [@Chamberlain2018].

## Evaluation of the results
Each specialist evaluated the performance of the raw and cleaned datasets, respectively concerning: 1) the number of flagged records; 2) the importance of specific tests; 3) the accuracy of the overall species richness maps; 4) the accuracy of the preliminary conservation assessment.

# Results
```{r}
# Table 1
tab1 <- read_excel("figures_tables/table_study_taxa.xlsx")

tab1 <- tab1 %>%
  mutate_all(linebreak) %>%
  select(-researcher) %>% 
  filter(!taxon %in% c("Entomobryidae", "Opisthonema", "Eugenia", "Harpalyce"))

# Table 2
tab2 <- read_csv("output/summary_table_flags.csv") %>% 
  dplyr::select(-coordinate_missing, -invalid_coords, -sea_coords, -gbif_coords,-inst_coords, -equal_coords) %>% 
  mutate(fraction = round(fraction * 100,1))

tab2 <- tab2[,c(1:3,14,5,7,4,8,6,10,13,11,12,9)]


tab2[,-c(1:4)] <- round((tab2[,-c(1:4)] / unlist(tab2[,2]) * 100), 1)

tab2 <- tab1 %>% 
  select(taxon) %>%  
  left_join(tab2, by = "taxon") %>% 
  replace_na(list(total_records = 0))

tab3 <- read_csv("output/table_results_conservation_assessment.csv") 

tab3 <- tab1 %>% 
  select(taxon) %>%  
  left_join(tab3, by = "taxon") %>% 
  replace_na(list(iucn_spnum = 0, raw_spnum = 0, flag_spnum = 0)) %>% 
  filter(iucn_spnum > 1)


aa <- read_csv("output/supplement_full_results_conservation_assessment.csv") %>% 
  mutate(iucn_category = ifelse(iucn_category %in% c("LC", "NT"), "LC or NT", iucn_category)) %>% 
  mutate(iucn_status = ifelse(iucn_category == "LC or NT", "not_threatened", "possibly_threatened"))
```

We found a total of `r nrow(dat)` occurrence records, with a median of `r dat %>% group_by(taxon) %>% dplyr::summarize(nrecs = n()) %>% ungroup() %>%  summarize(median(nrecs)) %>%  unlist()` records per study group and `r dat %>% group_by(species) %>% dplyr::summarize(nrecs = n()) %>% ungroup() %>%  summarize(median(nrecs)) %>%  unlist()` records per species (Table 3). We found most records for `r dat %>% group_by(taxon) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(1) %>% select(taxon) %>%  unlist()` (`r dat %>% group_by(taxon) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(1) %>% select(nrecs) %>%  unlist()`) and fewest for *`r dat %>% group_by(taxon) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(-1) %>% select(taxon) %>%  unlist()`* (`r dat %>% group_by(taxon) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(-1) %>% select(nrecs) %>%  unlist()`). The species with most records was *`r dat %>% group_by(species) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(1) %>% select(species)`* (`r dat %>% group_by(species) %>% dplyr::summarize(nrecs = n()) %>% arrange(nrecs) %>%  top_n(1) %>% select(nrecs)`).

Our automated tests flagged a total of `r sum(!dat$summary)` records (Fig. \ref{fig:total}), with a median of `r dat %>% group_by(taxon) %>% summarize(num = mean(!summary)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`% per group . Overall, the most important test was for duplicated records (on average `r dat %>% group_by(taxon) %>% summarize(num = mean(!.dpl)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`% per taxonomic group). The most important filtering steps based on record meta-data were for the basis of records (`r dat %>% group_by(taxon) %>% summarize(num = mean(!coordinate_base)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`%) and the collection year (`r dat %>% group_by(taxon) %>% summarize(num = mean(!record_age)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`%). The most important automated tests were for urban area (`r dat %>% group_by(taxon) %>% summarize(num = mean(!.urb)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`%), the capital coordinates (`r dat %>% group_by(taxon) %>% summarize(num = mean(!.cap)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`%) and the centroids of political units (`r dat %>% group_by(taxon) %>% summarize(num = mean(!.cen)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`%, Table 3, see Supplementary material 1 for the absolute numbers).  Only few records were flagged by the zero coordinates and biodiversity institutions tests (Fig. \ref{fig:split}), and no records were flagged by the sea test. 

*`r tab2 %>% arrange(fraction) %>% top_n(1) %>% select(taxon) %>% unlist()`*, *`r tab2 %>% arrange(fraction) %>% top_n(3) %>% select(taxon) %>% slice(2) %>% unlist()`*, and *`r tab2 %>% arrange(fraction) %>% top_n(3) %>% select(taxon) %>% slice(3) %>% unlist()`* had the highest fraction of flagged records (Table 3). In general, the different filters we tested were of similar importance for different study groups. There were few outstanding exceptions, including the particularly high proportions of records flagged by the basis of record test for *Tityus* (7.0%), Dipsadidae (5.6%), *Prosthechea* (5.0%) and *Tillandsia* (4.9%), by the collection year for Dipsadidae (11.3%), by the taxonomic identification level for  *Tityus* (1.6%), by the capital coordinates for *Oocephalus* (6.1%) and *Gaylussacia* (3.2%), as well as by the urban areas test for *Oocephalus* (13.3%) and Iridaceae (12.3%). 


Geographically, the records flagged by the basis of record and individuals collected tests were concentrated in Central America and southern North America, and a relative high number of records flagged due to their proximity to the centroids of political entities were located on Caribbean islands (Fig. \ref{fig:split}). See Supplementary material 2 for species richness maps using the raw and cleaned data for all study groups.


<!-- For the discussion check those individual groups and see what exactly was flagged here. -->
We found IUCN assessments for `r aa %>% filter(!is.na(iucn_category)) %>% filter(iucn_category != "DD") %>% filter(iucn_category != "EX") %>% nrow()` species that were also included in our distribution data from 10 of our study groups (Table 4, Supplementary material 3). The fraction of species evaluated varied among the study group, with a maximum of `r tab3 %>% select(iucn_frac_eval) %>% unlist() %>%  max()`% for *`r tab3 %>% arrange(desc(iucn_frac_eval)) %>% slice(1L) %>% select(taxon) %>%  unlist()`* and *`r tab3 %>% arrange(desc(iucn_frac_eval)) %>%  select(taxon) %>% slice(2) %>% unlist()`* and a minimum of `r tab3 %>% arrange(iucn_frac_eval) %>% slice(1) %>%  select(iucn_frac_eval) %>%  unlist()`% for `r tab3 %>% arrange(iucn_frac_eval) %>% slice(1) %>%  select(taxon) %>%  unlist()` (note that the number of species varied considerably among the groups). The median percentage of species per study group with an IUCN assessment was `r tab3 %>% select(iucn_frac_eval) %>% unlist() %>%  median()`%. A total of `r aa %>% filter(!is.na(iucn_category)) %>%  filter(iucn_category != "DD") %>%filter(iucn_category != "EX") %>%  mutate(test = iucn_status == "possibly_threatened") %>% select(test) %>% unlist() %>%  sum()` species were listed as Threatened by the IUCN global Red List (CR = `r aa %>% filter(iucn_category == "CR") %>% nrow()`, EN = `r aa %>% filter(iucn_category == "EN") %>% nrow()`, VU = `r aa %>% filter(iucn_category == "VU") %>% nrow()`) and `r  aa %>% filter(!is.na(iucn_category)) %>%  filter(iucn_category != "DD") %>%filter(iucn_category != "EX") %>%  mutate(test = iucn_status == "not_threatened") %>% select(test) %>% unlist() %>%  sum()` as Not Threatened.

We obtained automated conservation assessments for `r aa %>% select(flag_Category_CriteriaB) %>% filter(!is.na(flag_Category_CriteriaB)) %>% nrow()` species in the filtered dataset. Based on the filtered data the automated conservation assessment evaluated `r sum(aa$flag_status == "possibly_threatened", na.rm = TRUE)` species as possibly threatened (`r round(sum(aa$flag_status == "possibly_threatened", na.rm=TRUE) / aa %>% filter(!is.na(flag_status)) %>% nrow() * 100, 1)`%, CR = `r aa %>% filter(flag_Category_CriteriaB == "CR") %>% nrow()`, EN = `r aa %>% filter(flag_Category_CriteriaB == "EN") %>% nrow()`, VU = `r aa %>% filter(flag_Category_CriteriaB == "VU") %>% nrow()`). The automated assessment based on the filtered dataset agreed with the IUCN assessment for identifying species as possibly threatened (CR, EN, VU) for `r aa %>% filter(!is.na(iucn_category)) %>% filter(iucn_category != "DD") %>% filter(iucn_category != "EX") %>%  filter(!is.na(flag_status)) %>% mutate(agreement = iucn_status == flag_status) %>% select(agreement) %>% unlist() %>% sum() ` species (`r aa %>% filter(!is.na(iucn_category)) %>% filter(iucn_category != "DD") %>% filter(iucn_category != "EX") %>%  filter(!is.na(flag_status))  %>% mutate(agreement = iucn_status == flag_status) %>% select(agreement) %>% unlist() %>% mean() %>%  round(3) * 100`%; Table 4). Filtering reduced the EOO by `r tab3 %>%  select(flag_median_EOO_change) %>%  unlist() %>%  median()`% and the AOO by `r tab3 %>%  select(flag_median_AOO_change) %>%  unlist() %>%  median()`% on median per group. For the raw dataset the agreement with IUCN was higher at `r aa %>% filter(!is.na(iucn_category)) %>% filter(iucn_category != "DD") %>% mutate(agreement = iucn_status == raw_status) %>% select(agreement) %>% unlist() %>% sum() ` species (`r aa %>% filter(!is.na(iucn_category)) %>% filter(iucn_category != "DD") %>% mutate(agreement = iucn_status == raw_status) %>% select(agreement) %>% unlist() %>% mean() %>%  round(3) * 100`%).

# Discussion
We found, that automated flagging based on meta-data and automatic tests flagged on average `r dat %>% group_by(taxon) %>% summarize(num = mean(!summary)) %>%  select(num) %>% unlist() %>%  mean() %>% round(3) * 100`% of the records per taxonomic group. The filters for basis of record, duplicates, collection year, and urban areas flag the highest fraction of records (question 1). The importance of different tests was similar among taxonomic groups, with few exceptions especially for the tests on basis of record, collection year, capital coordinates, and urban areas (question 2). The results for species richness were similar between the raw and filtered data with some improvements by the filters and we found little impact of filtering on the accuracy of the automated conservation assessments (question 3).

<!-- 1. Which is the most relevant flagging mechanism? -->
The high proportion of records flagged as duplicates, may have several reasons. First, the deposition of duplicates from the same specimen hosted at different collections is common practice, especially for plants, where a duplication is easily feasible. Second, independent collections at similar localities may occur, in particular for local endemics, and third low coordinate precision, for instance based on automated geo-referencing from locality descriptions, may lump records from nearby localities. Of course, duplicated records do not represent errors per se, but they represent an unnecessary computational burden, which is often a bottleneck for analyses of datasets with millions of records. 

The aim of automated filtering is to identify possibly problematic records that are unsuitable for particular downstream analyses. Hence our tests include errors in the narrow sense (e.g., zero coordinates, equal lat/lon and seas tests) as well as records that are not necessary erroneous, but have a low precision (e.g., collection year, coordinate precision, centroids of political units) or are unnecessary (duplicates). The importance of each test and the linked thresholds must be judged based on the downstream analyses. For instance, records assigned to country centroids might be acceptable for inter-continental comparisons, but can be consider erroneous for species distribution modelling on a local scale. As our results show, adapting automated tests to the geographic study area or the taxonomic study group can be warranted. For instance, the high number of records flagged for centroids on the Lesser Antilles (Fig. \ref{fig:split}) might be overly strict, although we chose a conservative distance for the Political centroid test (1 km). 

<!-- 2. Does the importance of individual errors differ among taxonomic groups? -->
The number of records flagged by individual tests was similar across the study groups, suggesting that similar error types might be relevant for collections of plants and animals and partly also terrestrial and marine organisms. Therefore, the same tests can be used across taxonomic groups. Some notable exceptions stress the need to adapt each test to the taxonomic study group to balance data quality and data availability. The high fraction of records flagged by the basis of record test for *Tityus*, Dipsadidae, *Prosthechea* and *Tillandsia*, were mostly caused by a high number of records in these groups based on unknown collection methods, which might be caused by the contribution of specific datasets lacking this information for these groups. The high fraction of records flagged by the collection year test for Dispadidae was caused by a high collection activity already in the late 1880s and early 1900s, as can be expected for a charismatic group of reptiles, but also by 500 records dated to the year 1700. The latter records likely represent a data entry error. They are all contributed to GBIF from the same institution, and the institutions code for unavailable collection dates is 1700-01-01 - 2014-01-01, which has likely erroneously been converted to 1700. The high number of species flagged at capital coordinates and within urban areas for the plant groups Iridaceae, *Oocephalus*, and *Gaylussacia*, might be related to horticulture since at least some species of this group are commonly cultivated as ornamentals.

The general agreement between the species richness maps based on raw and filtered data was encouraging, for the use of this data for large-scale biogeographic research (Fig. \ref{fig:speciesrichness}, Supplementary material 1). The filter based on political centroids had an important impact on species richness patterns, which is congruent with the results from previous studied [@Maldonado2015]. Records assigned to country or province centroids are often old records, which are geo-referenced based on vague locality descriptions. These records are at the same time more likely to represent dubious species names, since they might be old synonyms or type specimen of species that have only been collected and described once, which are erroneously increasing species numbers.

The accuracy of the automated conservation assessment was in the same range as found by previous studies [@NicLughadha2019; @Zizka2019a]. The similar accuracy of the raw and filtered dataset for the automated conservation assessment was surprising, in particular given the EOO and AOO reduction observed in the filtered dataset (Table 4) and the impact of errors on spatial analyses observed in previous studies [@Gueta2016]. The robustness of the automated assessment was likely due to the fact that the EOO for most species was large, even after the considerable reduction caused by filtering. This might be caused by the structure of our comparison, which only included species that were evaluated by the IUCN Red List (and not considered as Data Deficient) and at the same time have occurrences recorded in GBIF, which biases the dataset towards species with larger ranges, since generally more data for them is available. The robustness of automated conservation assessments to data quality is encouraging, although these methods are only an approximation, especially for species with few collection records [@Rivers2011].


# Conclusions
Our results suggest that between 1/3rd and 2/3rds of the occurrence records obtained from public databases might be unsuitable for downstream biogeographic analyses, dependent on the taxonomic group. While the majority of these records might not be erroneous per se, they might be overly imprecise and thereby increase uncertainty of downstream results or put additional computational burden on the analyses. 

Overall, our results stress the importance of (meta-)data exploration before analyses and suggest that automated flagging can help to identify problematic records, but also highlight the necessity to customize tests and thresholds to the specific taxonomic groups and geographic area of interest.


# Acknowledgements
This study enrolled participants of the workshop "Biodiversity data: from field to yield" lead by Alexandre Antonelli and Alexander Zizka through the Programa de Pós Graduação em Sistemática e Evolução of the Universidade Federal do Rio Grande do Norte (UFRN) and promoted by the 6th Conference on Comparative Biology of Monocotyledons - Monocots VI. We thank the Pró-reitoria de Pesquisa and the Pró-reitoria de Pós-graduação of UFRN for the financial support (edital 02/2016 - internacionalização). AZ is thankful for funding by iDiv via the German Research Foundation (DFG FZT 118), specifically through sDiv, the Synthesis Centre of iDiv.

# Supplementary material
Appendix 1 - Table S1, the absolute number of flagged records per taxonomic group and test

Appendix 2 - Taxon specific richness maps and comments.

Appendix 3 - The full results of the conservation assessment


\newpage{}

# Tables
<!-- A table briefly describing the tests we ran -->
```{r tabletests, warning=FALSE}
tab0 <- read_xlsx("figures_tables/table_test_performed.xlsx")

kable(tab0, booktabs = T, escape = T, format="latex",
        caption = "The automated filters used in this study.")%>%
  kable_styling(font_size = 9, latex_options =c("striped", "hold_position")) %>%
   column_spec(1, width = "2cm", bold = FALSE, italic = FALSE)%>%
   column_spec(2, width = "2.5cm", bold = FALSE, italic = FALSE)%>%
   column_spec(3, width = "10cm", bold = FALSE, italic = FALSE)
```

<!-- A table presenting the study taxa -->
```{r tabletaxa, warning=FALSE}
kable(tab1, booktabs = T, escape = T, format="latex",
      col.names = linebreak(c("Taxon",
                              "Taxon rank",
                              "Realm",
                              "Common name",
                              "'Phylum'",
                              "Order",
                              "Family")),
        caption = "The study groups and their taxonomy. This study includes three marine and 13 terrestrial taxa, 6 of them animals, one group of fungi and 9 plants, belonging to 16 different orders.")%>%
  landscape()%>%
  kable_styling(font_size = 11) %>%
   row_spec(6, hline_after = TRUE) %>%
   row_spec(7, hline_after = TRUE) %>%
   column_spec(1, width = "2.5cm", bold = FALSE, italic = FALSE)%>%
   column_spec(2, width = "2cm", bold = FALSE, italic = FALSE)%>%
   column_spec(3, width = "2cm", bold = FALSE, italic = FALSE)%>%
   column_spec(4:5, width = "2.5cm", bold = FALSE, italic = FALSE)
```



<!-- A table presenting the overall results, the decrease in records by filtering, the change in conservation status -->
```{r tablecoords, warning=FALSE}
tab2 <- tab2 %>%
  mutate_all(linebreak) 

kable(tab2, booktabs = T, escape = T, format="latex",
      col.names = linebreak(c("Taxon",
                              "Total records",
                              "Records flagged",
                              "Fraction flagged [%]",
                              "Basis of record [%]",
                              "Collection year [%]",
                              "Coordinate precision [%]",
                              "Id-level [%]",
                              "Individual count [%]",
                              "Capitals [%]",
                              "Duplicates [%]",
                              "Political centroids [%]",
                              "Urban areas [%]",
                              "Zeros [%]")),
        caption = "The impact of automated flagging on occurrence records for 16 Neotropical taxa downloaded from www.gbif.org. From column four onwards the numbers show the percentage of records flagged by the respective test. Only tests that flagged at least 0.1\\% of the records in any group are shown.", format.args = list(big.mark = ","))%>%
  landscape()%>%
  kable_styling(font_size = 9) %>%
   row_spec(6, hline_after = TRUE) %>%
   row_spec(7, hline_after = TRUE) %>%
   column_spec(1, width = "2cm", bold = FALSE, italic = FALSE)%>%
   column_spec(2:6, width = "1.1cm", bold = FALSE, italic = FALSE)%>%
   column_spec(7:12, width = "1.3cm", bold = FALSE, italic = FALSE)%>%
  column_spec(13:14, width = "1cm", bold = FALSE, italic = FALSE)%>%
   add_header_above(c(" " = 1,
                      "Summary" = 3,
                     "Meta data filters" = 5,
                     "Automated filters" = 5))
```


```{r}
tab3 <- tab3 %>%
  mutate_all(linebreak)

kable(tab3, booktabs = T, escape = T, format="latex",
      col.names = linebreak(c("Taxon",
                              "n taxa",
                              "Evaluated [%]",
                              "Threatened [%]",
                              "n taxa",
                              "Threatened [%]",
                              "Match with IUCN [%]",
                              "n taxa",
                              "Threatened [%]",
                              "Match with IUCN [%]",
                              "EOO change compared to raw [%]",
                              "AOO change compared to raw [%]")),
        caption = "Conservation assessment for 16 Neotropical taxa of plants and animals based on three datasets. IUCN: global red list assessment obtained from www.iucn.org; GBIF Raw: Preliminary conservation assessment based on IUCN Criterion B using ConR and the raw dataset from GBIF; GBIF filtered: Preliminary conservation assessment based on IUCN Criterion B using ConR and the filtered dataset. Only taxa with at least on species evaluated by IUCN shown.", 
      format.args = list(big.mark = ","))%>%
  landscape()%>%
  kable_styling(font_size = 9) %>%
   column_spec(2:10, width = "1.2cm", bold = FALSE, italic = FALSE)%>%
   column_spec(11:12, width = "1.5cm", bold = FALSE, italic = FALSE)%>%
   add_header_above(c(" " = 1,
                      "IUCN" = 3,
                     "GBIF Raw" = 3,
                     "GBIF Filtered" = 5))
```

\newpage{}

# Figures
<!-- A map with number of species and where they have been removed -->
```{r total, out.width="\\linewidth", fig.cap=c('The difference of records available between the raw and filtered dataset, in a 100x100 km grid across the Neotropics'), echo=FALSE}
knitr::include_graphics(path = "./output/figure_number_of_records.jpg")
```



```{r split, out.width="\\linewidth", fig.cap=c('The geographic pattern of the occurrence records flagged by the automated tests of this study. The concentration of records flagged by the basis of record test and individual count test in Central A,erica and southern North America, suggest some specific problem with a contributing dataset from the region. Only filters that flagged at least one record are shown.'), echo=FALSE}
knitr::include_graphics(path = "./output/figure_number_of_records_split.jpg")
```



```{r speciesrichness, out.width="\\linewidth", fig.cap=c('The difference in species richness derived from the raw and filtered datasets (raw - filtered), for 16 taxa of plants and animals.'), echo=FALSE}
knitr::include_graphics(path = "./output/figure_number_species_richness_difference.jpg")
```

\newpage{}

# References

